import { Post } from "@/posts/models";
import { nanoid } from "nanoid";
import { simulateFetch } from "./utils";

export const posts: Post[] = [
  {
    serial: "wusXBhVLScuKEDYaw9Rl4",
    commentCount: 0,
    content:
      "Non tempora dolorem. Blanditiis velit mollitia maiores placeat harum ullam. Alias sequi reiciendis.",
    datetime: "2022-11-29T07:48:04.325Z",
    title: "Voluptatibus vitae iusto cumque earum praesentium.",
    slug: "voluptatibus-vitae-iusto-cumque-earum-praesentium",
    voteCount: 164,
  },
  {
    serial: "6ij5gHLM3M65h5ctbCact",
    commentCount: 0,
    content:
      "Quidem alias illo exercitationem illum assumenda eius recusandae in itaque. Saepe sit adipisci deserunt. Excepturi est quae necessitatibus esse repudiandae ea alias laudantium.",
    datetime: "2023-02-28T09:59:56.290Z",
    title: "Provident excepturi quis ipsam.",
    slug: "provident-excepturi-quis-ipsam",
    voteCount: 91,
  },
  {
    serial: "QKnOW58flYvaAdcv5QV3a",
    commentCount: 0,
    content:
      "Molestias officia quisquam quo fuga architecto deserunt. In quo sint hic tenetur. Blanditiis vel nesciunt facere vitae placeat atque sequi ducimus.",
    datetime: "2022-12-12T12:52:01.826Z",
    title: "Odit quod deleniti maiores tempore ad esse aut.",
    slug: "odit-quod-deleniti-maiores-tempore-ad-esse-aut",
    voteCount: 7,
  },
  {
    serial: "6AJ4GipP0gePIXbObUzRL",
    commentCount: 0,
    content:
      "Nisi nesciunt dolorum itaque culpa sed molestias. Illo id totam magni minima corrupti ipsa qui nulla. Maiores maxime voluptatem occaecati nemo atque recusandae distinctio blanditiis.",
    datetime: "2023-02-18T18:10:03.277Z",
    title:
      "Quis ratione temporibus beatae magni molestias optio iste distinctio veniam.",
    slug: "quis-ratione-temporibus-beatae-magni-molestias-optio-iste-distinctio-veniam",
    voteCount: 228,
  },
  {
    serial: "zFx8GW3onV9dwjLJUcvmV",
    commentCount: 0,
    content:
      "Ex ad illum tenetur non hic laudantium magni. Assumenda sunt nesciunt perferendis culpa sunt voluptate. Incidunt veritatis provident possimus soluta labore hic sunt rem laudantium.",
    datetime: "2022-09-09T22:08:55.810Z",
    title: "Quidem incidunt consequatur libero saepe suscipit hic doloribus.",
    slug: "quidem-incidunt-consequatur-libero-saepe-suscipit-hic-doloribus",
    voteCount: 405,
  },
  {
    serial: "UuUJugT8S0YaCM5ti_pOM",
    commentCount: 0,
    content:
      "Perferendis eius nulla laudantium ratione tempora ea repudiandae repudiandae. Quasi voluptatibus pariatur asperiores doloremque maxime vel incidunt. Necessitatibus quas nemo asperiores quia vero quisquam occaecati.",
    datetime: "2023-05-21T01:34:25.149Z",
    title: "Ea ipsam exercitationem at.",
    slug: "ea-ipsam-exercitationem-at",
    voteCount: 118,
  },
  {
    serial: "9BeRaf8cSXAxIY1cpM_34",
    commentCount: 0,
    content:
      "Nulla iure totam consectetur perferendis assumenda earum amet. Sapiente quae nesciunt consequuntur. Veniam enim consequatur.",
    datetime: "2023-02-26T12:48:28.045Z",
    title: "Dolore expedita doloremque.",
    slug: "dolore-expedita-doloremque",
    voteCount: 462,
  },
  {
    serial: "q03l_FYxFc5IM3xrTQvve",
    commentCount: 0,
    content:
      "Vel blanditiis omnis suscipit. Doloribus iure veniam ex iste harum corrupti nisi quas totam. Ratione tempora nemo quia deleniti asperiores ducimus enim.",
    datetime: "2022-08-05T14:05:16.004Z",
    title: "Natus delectus rerum quisquam soluta.",
    slug: "natus-delectus-rerum-quisquam-soluta",
    voteCount: 445,
  },
  {
    serial: "9d5SIOKSLLY2ZWy4bjcSq",
    commentCount: 0,
    content:
      "Atque dolorum hic ipsa eveniet possimus maxime quisquam ex. Similique assumenda rem mollitia quod sunt atque similique sunt. Esse occaecati ea nesciunt vitae libero deleniti aut maiores.",
    datetime: "2022-12-21T02:29:33.882Z",
    title: "Beatae corporis molestias.",
    slug: "beatae-corporis-molestias",
    voteCount: 302,
  },
  {
    serial: "oxM7NqWm4s47I4Bl7HV-_",
    commentCount: 0,
    content:
      "Corporis ratione numquam temporibus rem repellendus similique. Ipsum odit adipisci in sit non distinctio a distinctio nesciunt. Animi ab sequi eligendi magni optio asperiores voluptas.",
    datetime: "2022-09-14T01:07:55.521Z",
    title: "Atque dolorum ratione quisquam.",
    slug: "atque-dolorum-ratione-quisquam",
    voteCount: 153,
  },
  {
    serial: "B1NpDN8ocAOzgJsf8PSM6",
    commentCount: 0,
    content:
      "Laborum harum tempora nesciunt corporis ea iure asperiores itaque eligendi. Fuga totam possimus. Porro culpa voluptate perspiciatis enim veniam porro.",
    datetime: "2022-08-31T18:01:35.276Z",
    title: "Rem repellat optio quos.",
    slug: "rem-repellat-optio-quos",
    voteCount: 380,
  },
  {
    serial: "kIGlNmnLKhPijGavNhTUK",
    commentCount: 0,
    content:
      "Animi velit consequuntur suscipit ab distinctio officia ipsam. Ex numquam impedit occaecati delectus expedita facere praesentium. Debitis quia expedita ab iure esse blanditiis.",
    datetime: "2022-08-30T05:01:10.585Z",
    title: "Id omnis cum ut ab alias eligendi.",
    slug: "id-omnis-cum-ut-ab-alias-eligendi",
    voteCount: 119,
  },
  {
    serial: "27FxKqqUQoapKSPlx5Dfm",
    commentCount: 0,
    content:
      "Odit aut voluptatem incidunt quod quia tempora nulla officiis voluptatum. Nostrum consequuntur aspernatur debitis quo ipsam. Est architecto itaque sunt ea earum error quas unde dignissimos.",
    datetime: "2023-05-18T16:55:59.674Z",
    title: "Quas eveniet corporis numquam odit omnis dolores quia accusantium.",
    slug: "quas-eveniet-corporis-numquam-odit-omnis-dolores-quia-accusantium",
    voteCount: 360,
  },
  {
    serial: "wEPpIh9KI9xCFcVyBXNs-",
    commentCount: 0,
    content:
      "Exercitationem dolorem illo delectus optio molestias inventore tempora amet iusto. Rerum quaerat deserunt amet illo. Magni nulla tenetur animi.",
    datetime: "2022-08-08T18:59:28.922Z",
    title:
      "Repellat corporis dicta laudantium beatae odit sed dolores hic molestiae.",
    slug: "repellat-corporis-dicta-laudantium-beatae-odit-sed-dolores-hic-molestiae",
    voteCount: 225,
  },
  {
    serial: "Q3sOSWcaQ6kN3frios2pB",
    commentCount: 0,
    content:
      "Veniam accusamus nulla eligendi officia esse eius accusantium earum atque. Vitae amet ex. Dolorem libero cupiditate veniam accusantium doloremque.",
    datetime: "2023-04-13T02:34:11.925Z",
    title: "Vitae at veniam fugit excepturi nihil.",
    slug: "vitae-at-veniam-fugit-excepturi-nihil",
    voteCount: 209,
  },
  {
    serial: "Jg6f-mGqySlXYqaQBoioS",
    commentCount: 0,
    content:
      "Sunt excepturi cumque praesentium itaque odio alias libero sunt. Sed debitis est doloribus quo aperiam rerum. Mollitia ducimus ab dolorum ullam.",
    datetime: "2022-09-11T07:19:05.535Z",
    title: "Labore assumenda consectetur incidunt nostrum.",
    slug: "labore-assumenda-consectetur-incidunt-nostrum",
    voteCount: 236,
  },
  {
    serial: "49_ZX2aYEiFTWRaqtf2d2",
    commentCount: 0,
    content:
      "Nesciunt aut facilis eligendi velit iusto aliquam dolores veniam perferendis. Cumque modi nam. Dolores quia ad magni doloribus minima alias.",
    datetime: "2023-05-13T01:53:52.132Z",
    title: "Eum accusamus inventore vel qui tenetur provident.",
    slug: "eum-accusamus-inventore-vel-qui-tenetur-provident",
    voteCount: 143,
  },
  {
    serial: "-Ze65mD41M8qx2G8x-Zra",
    commentCount: 0,
    content:
      "Et possimus odit in. Eligendi odit similique. Iste reiciendis eveniet.",
    datetime: "2022-08-13T21:39:59.971Z",
    title: "Explicabo nisi dignissimos asperiores doloribus in aspernatur quo.",
    slug: "explicabo-nisi-dignissimos-asperiores-doloribus-in-aspernatur-quo",
    voteCount: 267,
  },
  {
    serial: "3TGZMwwSUJt2eoSWe3fut",
    commentCount: 0,
    content:
      "Occaecati rem unde porro ipsa harum accusantium. Optio ad reprehenderit ex officia eligendi doloribus fugit dolores eaque. Commodi provident dolorem similique excepturi consequatur iste aspernatur.",
    datetime: "2023-05-26T10:12:09.201Z",
    title: "Iusto libero nemo dicta ea qui.",
    slug: "iusto-libero-nemo-dicta-ea-qui",
    voteCount: 159,
  },
  {
    serial: "Eiud0OG4qDQC2UYOxR8vf",
    commentCount: 3,
    content:
      "Neque voluptatibus porro. Suscipit sunt impedit similique accusantium. Sit minima possimus eaque voluptates iste beatae.",
    datetime: "2023-03-18T14:20:28.663Z",
    title: "Quasi maxime a.",
    slug: "quasi-maxime-a",
    voteCount: 487,
  },
  {
    serial: "wmWFRmcJqryXRLaRP-q_B",
    commentCount: 0,
    content:
      "Aliquid ad impedit possimus id et rem. Sit doloremque minus quo cupiditate ipsum odio temporibus voluptates blanditiis. Dolore voluptates neque deleniti.",
    datetime: "2023-03-15T23:14:57.568Z",
    title: "Iste eligendi fugiat nihil quibusdam.",
    slug: "iste-eligendi-fugiat-nihil-quibusdam",
    voteCount: 424,
  },
  {
    serial: "92UifBZhypj7egbUcVhEY",
    commentCount: 0,
    content:
      "Neque repudiandae sequi architecto pariatur. Nemo id reprehenderit voluptatum corrupti quos qui modi. Temporibus aperiam expedita sapiente ratione.",
    datetime: "2022-08-01T00:21:55.586Z",
    title: "Deleniti alias ullam facere reiciendis.",
    slug: "deleniti-alias-ullam-facere-reiciendis",
    voteCount: 269,
  },
  {
    serial: "Czg12oOCjv773_x-OkLTU",
    commentCount: 0,
    content:
      "Ex impedit unde voluptates. Tempore voluptates magnam odio labore delectus. Nulla labore nostrum molestias nemo.",
    datetime: "2023-04-23T19:08:17.777Z",
    title:
      "Repellendus ea laborum veniam impedit libero neque voluptas quod necessitatibus.",
    slug: "repellendus-ea-laborum-veniam-impedit-libero-neque-voluptas-quod-necessitatibus",
    voteCount: 29,
  },
  {
    serial: "AoeMG-xDvaWteXJcr4nkK",
    commentCount: 0,
    content:
      "Veniam nesciunt a. Dolorem aliquam ab illo molestiae maiores ullam nostrum deleniti tenetur. Non magni quisquam quia voluptas pariatur ducimus sint mollitia asperiores.",
    datetime: "2023-05-05T12:26:13.606Z",
    title: "Odio maiores maiores accusamus laboriosam atque iusto.",
    slug: "odio-maiores-maiores-accusamus-laboriosam-atque-iusto",
    voteCount: 461,
  },
  {
    serial: "jFxNCcQqmxNrSUREQnIoM",
    commentCount: 0,
    content:
      "Neque nulla sapiente. Consequuntur provident consectetur. Optio saepe sit placeat officiis nihil veniam illo enim.",
    datetime: "2023-03-16T03:50:17.010Z",
    title: "Ipsam blanditiis laudantium.",
    slug: "ipsam-blanditiis-laudantium",
    voteCount: 280,
  },
  {
    serial: "_N4SA4RjgCfYc35OqJbbh",
    commentCount: 0,
    content:
      "Quisquam commodi voluptatibus. Molestiae quo suscipit quod ab autem. In quo dolores est.",
    datetime: "2022-09-26T07:43:24.998Z",
    title:
      "Deleniti ea facilis adipisci repellat perspiciatis possimus assumenda sunt.",
    slug: "deleniti-ea-facilis-adipisci-repellat-perspiciatis-possimus-assumenda-sunt",
    voteCount: 363,
  },
  {
    serial: "R290NUyrdHmNh9lNr-Sfw",
    commentCount: 0,
    content:
      "Temporibus commodi eos maxime. Quo quo hic placeat laudantium tempore quod. Perferendis consequuntur possimus.",
    datetime: "2022-09-05T00:08:48.775Z",
    title: "Accusantium doloremque suscipit beatae laborum odio.",
    slug: "accusantium-doloremque-suscipit-beatae-laborum-odio",
    voteCount: 7,
  },
  {
    serial: "CQlNZLo7NBQ9w2mNPdjeM",
    commentCount: 0,
    content:
      "Eligendi a quod deleniti placeat facere et ut odio quae. Qui quibusdam harum repudiandae. Quaerat voluptas ut eaque laudantium rem id in impedit vitae.",
    datetime: "2023-05-10T13:33:42.931Z",
    title: "Sint earum odit neque.",
    slug: "sint-earum-odit-neque",
    voteCount: 378,
  },
  {
    serial: "nXxOtcq1Tpp1JxzZ3swCE",
    commentCount: 0,
    content:
      "Voluptates quam porro sapiente illo. Perferendis fuga quisquam cumque. Assumenda quam omnis aliquam saepe facere doloremque adipisci rerum.",
    datetime: "2023-02-08T11:15:37.906Z",
    title: "Mollitia maxime occaecati officiis.",
    slug: "mollitia-maxime-occaecati-officiis",
    voteCount: 340,
  },
  {
    serial: "fiKNYVWqIw_zvQUPhrNol",
    commentCount: 0,
    content:
      "Occaecati placeat suscipit soluta corporis consequatur. Voluptatem delectus eaque. Sapiente distinctio nam id aut dolore dolores.",
    datetime: "2022-09-02T06:31:53.387Z",
    title: "Ut ab fugiat.",
    slug: "ut-ab-fugiat",
    voteCount: 88,
  },
  {
    serial: "0LunC4wUYXkrPZTMx75t2",
    commentCount: 0,
    content:
      "Pariatur id rem mollitia nam magnam doloribus est assumenda enim. Possimus quas minus vitae magnam magnam itaque earum tenetur natus. Exercitationem unde similique dolorem ipsam quasi.",
    datetime: "2022-10-09T16:47:08.150Z",
    title: "Maiores amet sapiente dolorum alias tenetur modi ad quas.",
    slug: "maiores-amet-sapiente-dolorum-alias-tenetur-modi-ad-quas",
    voteCount: 374,
  },
  {
    serial: "CEKk7GuKQ_RXRWr3dd_2o",
    commentCount: 0,
    content:
      "Rerum enim libero repudiandae est ex excepturi. Blanditiis iusto sapiente omnis minus ipsa et. Aut nostrum quidem distinctio facilis consequuntur dolorum.",
    datetime: "2023-01-30T20:37:38.235Z",
    title:
      "Facilis itaque placeat iusto facilis molestias debitis dicta quaerat.",
    slug: "facilis-itaque-placeat-iusto-facilis-molestias-debitis-dicta-quaerat",
    voteCount: 143,
  },
  {
    serial: "XatDkOPaZwb3moKTfGkfY",
    commentCount: 0,
    content:
      "Cupiditate sint animi ab id amet blanditiis doloribus maxime velit. Facere fugit minima. Eum amet adipisci necessitatibus ea distinctio et.",
    datetime: "2023-01-25T19:16:56.401Z",
    title: "Officiis veniam adipisci beatae voluptas ipsa nam exercitationem.",
    slug: "officiis-veniam-adipisci-beatae-voluptas-ipsa-nam-exercitationem",
    voteCount: 26,
  },
  {
    serial: "JZwoRjcbNTOPQl_91B4RY",
    commentCount: 0,
    content:
      "Officia occaecati eligendi temporibus quaerat alias facere voluptates. Animi accusantium officiis numquam quo dolorum natus hic perspiciatis. Perferendis facere esse et quod facilis repellendus ducimus nesciunt.",
    datetime: "2023-01-14T06:57:22.274Z",
    title: "Autem deserunt nobis dolore sequi a autem.",
    slug: "autem-deserunt-nobis-dolore-sequi-a-autem",
    voteCount: 204,
  },
  {
    serial: "O20MX4Y_aAchRs7C6QJ-A",
    commentCount: 0,
    content:
      "Animi beatae amet suscipit sequi laboriosam. Atque minus dolorem amet molestias. Rerum voluptatibus quia quidem laborum.",
    datetime: "2022-12-07T14:56:22.378Z",
    title: "Dolore laboriosam laboriosam nesciunt nobis asperiores.",
    slug: "dolore-laboriosam-laboriosam-nesciunt-nobis-asperiores",
    voteCount: 278,
  },
  {
    serial: "5_GIe5XNxKbH2E9Zm2u66",
    commentCount: 0,
    content:
      "Modi illo esse quidem amet numquam. Corporis blanditiis mollitia ex quod distinctio quos libero consequuntur est. Quia pariatur ipsa a debitis deleniti minima odit.",
    datetime: "2023-05-18T04:11:36.329Z",
    title:
      "Dolorum occaecati corporis officia consequatur incidunt et nesciunt culpa accusantium.",
    slug: "dolorum-occaecati-corporis-officia-consequatur-incidunt-et-nesciunt-culpa-accusantium",
    voteCount: 412,
  },
  {
    serial: "SVCbxJwgAdXyRPB6aKtv8",
    commentCount: 0,
    content:
      "Assumenda distinctio incidunt minus natus recusandae. Facere doloribus hic accusantium in quis. Voluptatibus voluptatem ea reprehenderit iusto.",
    datetime: "2023-01-28T01:02:24.558Z",
    title:
      "Ab porro est similique impedit eos aliquam itaque perferendis quidem.",
    slug: "ab-porro-est-similique-impedit-eos-aliquam-itaque-perferendis-quidem",
    voteCount: 231,
  },
  {
    serial: "Gv0nMw8XEPyazycWZ4Cub",
    commentCount: 0,
    content:
      "Id odio quidem vero. Nobis ipsum culpa quod et perspiciatis totam porro exercitationem blanditiis. Repellat modi aut illum quibusdam deserunt repellendus sunt rem.",
    datetime: "2022-10-20T09:49:35.025Z",
    title:
      "Quia culpa perspiciatis expedita nemo in dignissimos vitae expedita.",
    slug: "quia-culpa-perspiciatis-expedita-nemo-in-dignissimos-vitae-expedita",
    voteCount: 10,
  },
  {
    serial: "DPAj5xnoonI0cGL6Y8BiL",
    commentCount: 0,
    content:
      "Unde ipsum nostrum nesciunt accusantium ullam nobis perferendis. Reiciendis quos et dolore atque odit cupiditate reprehenderit. Necessitatibus harum cum sint soluta repellat natus.",
    datetime: "2023-05-18T12:52:15.732Z",
    title: "Voluptatibus ex corporis eos eos.",
    slug: "voluptatibus-ex-corporis-eos-eos",
    voteCount: 184,
  },
  {
    serial: "QULIODNfM7SMvgm4cC5_I",
    commentCount: 0,
    content:
      "Voluptatibus dolores repudiandae corporis animi iste commodi repudiandae unde. Quasi voluptate tenetur sequi aperiam voluptatibus reprehenderit officiis adipisci. Explicabo vel similique mollitia quibusdam.",
    datetime: "2022-06-14T19:52:39.344Z",
    title:
      "Rem cupiditate debitis id fuga doloribus corrupti repudiandae quisquam reiciendis.",
    slug: "rem-cupiditate-debitis-id-fuga-doloribus-corrupti-repudiandae-quisquam-reiciendis",
    voteCount: 334,
  },
];

type GetPostListParams = {
  page: number;
  pageSize: number;
  query: string;
  sortBy: "hot" | "new";
};

export function getPostList({
  page,
  pageSize,
  query,
  sortBy,
}: GetPostListParams) {
  return simulateFetch(() => {
    const filteredPosts = posts.filter((post) =>
      post.title.toLowerCase().includes(query)
    );
    const sortedPosts = filteredPosts.sort((prev, next) =>
      sortBy === "new"
        ? new Date(next.datetime).getTime() - new Date(prev.datetime).getTime()
        : next.voteCount - prev.voteCount
    );
    const totalItem = sortedPosts.length;
    const totalPage = Math.ceil(totalItem / pageSize);

    const start = pageSize * (page - 1);
    const end = start + pageSize;
    const paginatedPosts = sortedPosts.slice(start, end);

    return {
      data: paginatedPosts,
      total: totalItem,
      hasNextPage: page < totalPage,
    };
  });
}

type GetPostDetailParams = {
  slug: string;
};

export function getPostDetail({ slug }: GetPostDetailParams) {
  return simulateFetch(() => {
    const data = posts.find((post) => post.slug === slug);

    if (!data) throw new Error("Post is not found");

    return { data };
  });
}

type CreatePostParams = {
  post: Omit<
    Post,
    "serial" | "datetime" | "voteCount" | "commentCount" | "comments"
  >;
};

export function createPost({ post }: CreatePostParams) {
  return simulateFetch(() => {
    const newPost: Post = {
      ...post,
      commentCount: 0,
      voteCount: 0,
      datetime: new Date().toISOString(),
      serial: nanoid(),
    };

    posts.push(newPost);

    return {
      success: true,
    };
  });
}

type VotePostParams = {
  slug: string;
  amount: number;
};

export function votePost({ amount, slug }: VotePostParams) {
  return simulateFetch(() => {
    const index = posts.findIndex((post) => post.slug === slug);
    if (index === -1) throw new Error("Post slug is not found");

    posts[index] = {
      ...posts[index],
      voteCount: posts[index].voteCount + amount,
    };

    return {
      success: true,
    };
  });
}
